function loadLevelData(e,t=null,n){const a="undefined"!=typeof mlcmVars&&"1"===mlcmVars.use_static;if(!a)return void loadLevelDataAjax(e,t,n);let l,o;if(1===e){const t=mlcmVars.file_versions&&mlcmVars.file_versions[1]?mlcmVars.file_versions[1]:"";l=mlcmVars.static_url+"/level-1.js"+(t?"?v="+t:""),o="mlcmLevel1"}else{if(!(e>1&&e<=5))return void n(null);const t=mlcmVars.file_versions&&mlcmVars.file_versions[e]?mlcmVars.file_versions[e]:"";l=mlcmVars.static_url+"/level-"+e+".js"+(t?"?v="+t:""),o="mlcmLevel"+e}if(void 0!==window[o])return void n(window[o]);const r=document.createElement("script");r.src=l,r.async=!0;const c=setTimeout(()=>{r.onerror=null,r.onload=null,document.head.removeChild(r),console.warn("MLCM: Timeout loading JS file, falling back to AJAX"),loadLevelDataAjax(e,t,n)},1e4);r.onload=function(){if(clearTimeout(c),void 0!==window[o]){const e=window[o];delete window[o],n(e)}else console.warn("MLCM: JS file loaded but variable not found, falling back to AJAX"),loadLevelDataAjax(e,t,n);document.head.removeChild(r)},r.onerror=function(){clearTimeout(c),console.warn("MLCM: Failed to load JS file, falling back to AJAX"),document.head.removeChild(r),loadLevelDataAjax(e,t,n)},document.head.appendChild(r)}
function loadLevelDataAjax(e,t,n){if("undefined"==typeof mlcmVars||!mlcmVars.ajax_url)return console.error("MLCM: mlcmVars not defined"),void n(null);jQuery.ajax({url:mlcmVars.ajax_url,method:"POST",cache:!1,data:{action:"mlcm_get_subcategories",parent_id:t||0,_t:(new Date).getTime()},success:e=>{e.success&&e.data?n(e.data):(console.error("MLCM: AJAX response error",e),n(null))},error:(e,t,a)=>{console.error("MLCM: AJAX error",a),n(null)}})}
jQuery(function(e){const t=e(".mlcm-container");if(!t.length)return;const n=1===t.data("use-static")||"1"===t.data("use-static"),a=parseInt(t.data("levels"))||3;n?loadLevelData(1,0,function(n){n&&Array.isArray(n)&&o(1,n)}):(()=>{const n=e('.mlcm-select[data-level="1"]');if(n.length&&n.find("option").length<=1){const e=t.data("level-1-data");e&&Array.isArray(e)&&o(1,e)}})();const l=t.find(".mlcm-go-button");l.length>1&&l.not(":first").remove();const r=parseInt(t.css("gap")),c=t.css("font-size");r&&(t[0].style.setProperty("--mlcm-gap",`${r}px`)),c&&t[0].style.setProperty("--mlcm-font-size",c);let i;t.on("change",".mlcm-select",function(){const n=e(this),l=parseInt(n.data("level")),r=parseInt(n.val());if(clearTimeout(i),-1===r)return void s(l);i=setTimeout(()=>{d(n,l,r)},150)}),t.on("click",".mlcm-go-button",p);const u=(()=>{let n;return()=>{clearTimeout(n),n=setTimeout(()=>{window.matchMedia("(max-width: 768px)").matches&&t.find(".mlcm-go-button").css({width:"100%",margin:"10px 0 0 0"})},100)}})();function s(n){t.find(".mlcm-select").each(function(){const t=e(this);t.data("level")>n&&t.val("-1").prop("disabled",!0).html(`<option value="-1">${mlcmVars.labels[t.data("level")-1]}</option>`)})}function o(t,n){const a=e(`.mlcm-select[data-level="${t}"]`);if(!a.length)return;const l=mlcmVars.labels[t-1];let r=`<option value="-1">${l}</option>`;if(Array.isArray(n))r+=n.map(e=>{const t=e.id||e.term_id||"",n=e.name||"",a=e.slug||"",l=e.url||"";return`<option value="${t}" data-slug="${a}" data-url="${l}">${n}</option>`}).join("");else if("object"==typeof n){const e=Object.values(n)[0];Array.isArray(e)&&(r+=e.map(e=>{const t=e.id||e.term_id||"",n=e.name||"",a=e.slug||"",l=e.url||"";return`<option value="${t}" data-slug="${a}" data-url="${l}">${n}</option>`}).join(""))}a.prop("disabled",!1).html(r)}function m(e,t){if(Array.isArray(e))return e;if("object"==typeof e&&e[t])return e[t];return null}function d(l,r,c){if(r>=a)return void p();if(!c||c<=0)return;const i=r+1,u=e(`.mlcm-select[data-level="${i}"]`);if(u.length){const e=mlcmVars.labels[i-1];u.addClass("mlcm-loading").prop("disabled",!0).html(`<option value="-1">${e}</option>`)}loadLevelData(i,c,function(a){if(!a){console.error("MLCM: Failed to load level data");const t=e(`.mlcm-select[data-level="${i}"]`);if(t.length){const e=mlcmVars.labels[i-1];t.removeClass("mlcm-loading").prop("disabled",!1).html(`<option value="-1">${e}</option>`)}return}const u=m(a,c),d=u&&(Array.isArray(u)&&u.length>0||"object"==typeof u&&null!==u&&Object.keys(u).length>0);if(d)h(l,r,u),s(i);else{const t=e(`.mlcm-select[data-level="${i}"]`);if(t.length){const e=mlcmVars.labels[i-1];t.removeClass("mlcm-loading").prop("disabled",!0).html(`<option value="-1">${e}</option>`)}p()}})}function h(t,n,a){const l=n+1,r=e(`.mlcm-select[data-level="${l}"]`);if(!r.length)return;const c=mlcmVars.labels[l-1],i=r.attr("id"),u=`mlcm-label-level-${l}`;let s=e(`#${u}`);s.length?(s.text(c),s.attr("for",i)):(s=e(`<label for="${i}" id="${u}" class="mlcm-screen-reader-text">${c}</label>`),r.before(s)),r.attr("aria-labelledby",u);let o="";if(Array.isArray(a))o=a.map(e=>{const t=e.id||e.term_id||"",n=e.name||"",a=e.slug||"",l=e.url||"";return`<option value="${t}" data-slug="${a}" data-url="${l}">${n}</option>`}).join("");else if("object"==typeof a&&null!==a){const e=Object.entries(a);e.sort((e,t)=>{const n=(e[1].name||"").toUpperCase(),a=(t[1].name||"").toUpperCase();return n.localeCompare(a)}),o=e.map(([e,t])=>`<option value="${e}" data-slug="${t.slug||""}" data-url="${t.url||""}">${t.name||""}</option>`).join("")}r.removeClass("mlcm-loading").prop("disabled",!1).html(`<option value="-1">${c}</option>${o}`)}function p(){const n=t.find(".mlcm-select").filter(function(){return"-1"!==e(this).val()}).last();if(n.length){const e=n.find("option:selected").data("url");e&&(e.startsWith("http://")||e.startsWith("https://"))&&(window.location.href=e)}}u(),e(window).on("resize",u)});

